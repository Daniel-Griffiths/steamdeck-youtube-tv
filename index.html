<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Youtube</title>
    <meta
      http-equiv="Content-Security-Policy"
      content="script-src 'self' 'unsafe-inline';"
    />
  </head>
  <body>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
    </style>
    <webview
      id="webview"
      tabindex="0"
      src="https://www.youtube.com/tv?env_forceFullAnimation=true"
      httpreferrer="https://www.youtube.com/tv"
      style="height: 100vh; width: 100vw; background: #000"
      useragent="Mozilla/5.0 (Linux; Android 12) Cobalt/22.2.3-gold (PS4)"
    ></webview>
    <script>
      const { GamepadListener } = require("gamepad.js");

      const webview = document.getElementById("webview");

      document.addEventListener("DOMContentLoaded", function () {
        webview.focus();
      });

      // Button to key mapping (using original working key codes)
      // Standard gamepad: 0=Cross/A, 1=Circle/B, 2=Square/X, 3=Triangle/Y
      // 12=Up, 13=Down, 14=Left, 15=Right
      const buttonMap = {
        0: String.fromCharCode(0x0d), // Cross/A - Enter (carriage return)
        1: "Escape", // Circle/B - Back
        12: "Up", // D-pad Up
        13: "Down", // D-pad Down
        14: "Left", // D-pad Left
        15: "Right", // D-pad Right
      };

      const listener = new GamepadListener();

      listener.on("gamepad:button", (event) => {
        const { button, pressed } = event.detail;
        const keyCode = buttonMap[button];

        if (!keyCode) return;

        webview.sendInputEvent({
          type: pressed ? "keyDown" : "keyUp",
          keyCode,
        });
      });

      listener.start();
    </script>
  </body>
</html>
